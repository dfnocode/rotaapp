function asyncGeneratorStep(e,t,r,n,a,i,o){try{var c=e[i](o),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function o(e){asyncGeneratorStep(i,n,a,o,c,"next",e)}function c(e){asyncGeneratorStep(i,n,a,o,c,"throw",e)}o(void 0)}))}}define(["jquery","safe","api","api!core.getAppCfg","checkperm","clitpl","moment","dateDiff","ApiError","views/filterform","jquery-block","jquery-addons","bootstrap","bootstrap-datepicker"],(function(e,t,r,n,a,i,o,c,s,u){return function(){var f=_asyncToGenerator(regeneratorRuntime.mark((function f(d){var l,p,m,_,v,w,h,b,g;return regeneratorRuntime.wrap((function(f){for(;;)switch(f.prev=f.next){case 0:return g=function(r){var n=_.serialize().split("&").filter((function(e){return e.split("=")[1]})).join("&");l.transform&&(n+="&transform="+l.transform),n.includes("from=")&&(window.history.replaceState(window.history.state,null,window.location.pathname+"?"+n),p.block(),t.run((function(){return e.ajax({cache:!1,url:r,data:n})}),(function(e,t){p.unblock(),e||m.html(t),window.appError(e)})))},l=d.filter,f.next=4,u({from:l.from,to:l.to,setStartDate:l.transform||a(["reserve.date.edit.to.past"])?null:o.utc(Date.nowUTC()).format("L")});case 4:p=e("#tabboard"),m=p.find("#found_apt"),_=p.find("#filterform"),v=window._prefix+"booking_apartment/0/avatar",_.on("submit",(function(){w=o.utc(_.find("input.from").data("datepicker").getUTCDate()).format("YYYY-MM-DD"),h=o.utc(_.find("input.to").data("datepicker").getUTCDate()).format("YYYY-MM-DD"),b=_.find('[name="persons"]').val();var e=c(w,h,"day");if(e>n._i_maxReserveDuration)return window.appError(new s(s.Message.EXCEEDS_MAX_STAY,s.Subject.EXCEEDS_MAX_STAY,n._i_maxReserveDuration)),!1;if(!Number.isFinite(e)||e<n._i_minReserveDuration)return window.appError(new s(s.Message.SUBCEEDS_MIN_STAY,s.Subject.SUBCEEDS_MIN_STAY,n._i_minReserveDuration)),!1;if(!l.transform&&o.utc(w).isBefore(Date.nowUTC(),"day")){if(!a(["reserve.date.edit.to.past"]))return!1;p.find("#past-alert").collapse("show")}else p.find("#past-alert").collapse("hide");return t.back(g,v),!1})),m.on("click",".reload",(function(){return v=e(this).attr("href"),_.submit(),!1})),m.on("click",".selectApartment",(function(){var n=e(this).data("_id");return t.run((function(e){p.find("#selected_apt").block(),r.call("apartment.getApartment",{_id:n},t.sure(e,(function(n){var o=n[0];r.call("price.getPrice",o._id,w,h,{persons:b,_b_skipPriceError:a(["reserve.value.define"])},t.sure(e,(function(r){i.render("reservation/booking_apartment_selected",o,t.sure_result(e,(function(e){p.find("#apartment").find("#selected_apt").html(e),p.find("#apartment").trigger("ApartmentSelected",[o,r.glr[0],r._b_hasPriceError])})))})))})))}),(function(e){window.appError(e),p.find("#selected_apt").unblock()})),!1})),m.on("click",".selectApartmentExt",(function(n){var a=e(this).data("idchannel"),o=e(this).closest(".apt-item").data("_id"),c=e(this).closest(".apt-item").data("id");return t.run((function(e){p.find("#selected_apt").block(),r.call("crossselling.getFrontApartment",{idchannel:a,id:c,query:{}},t.sure(e,(function(n){var c=n.apartment;r.call("crossselling.getPrice",{idchannel:a,_id:o,from:w,to:h,options:{persons:b}},t.sure(e,(function(r){var n=r.price;i.render("reservation/booking_apartment_selected",c,t.sure_result(e,(function(e,t){p.find("#apartment").find("#selected_apt").html(e),p.find("#apartment").trigger("ApartmentSelected",[c,n.glr[0]])})))})))})))}),(function(e){window.appError(e),p.find("#selected_apt").unblock()})),!1})),l.from&&l.to&&_.submit();case 13:case"end":return f.stop()}}),f)})));return function(e){return f.apply(this,arguments)}}()}));