define(["jquery","lodash","url","jquery-block"],(function(t,r,i){"use strict";var o="/image/"+window._wtmid,a=r.debounce((function(r){window.requestAnimationFrame((function(){t(document.body).find("img").filter("[data-original]:not([src])").each((function(){this.loading="lazy";var r=t(this);r.attr("loading","lazy"),r.addClass("img-responsive");var a=r.data("original");function e(){if(r.off("error",n),r.off("load",e),r.removeAttr("data-original"),a.query.width&&r.data("original").includes("/image/")){var t=a.query.width,o=a.query.height||0;r.attr("width",t),o&&r.attr("height",o);var d=i.format(a,0)+" 1x";a.query.width=2*t,a.query.height&&(a.query.height=2*o),d+=", "+i.format(a,0)+" 2x",r.attr("srcset",d.trim())}}function n(){r.off("error",n),r.off("load",e),r.css("background-color","#ccc").attr("src",o).removeAttr("data-original")}a=i.parse(a),window._wtmpostfix&&(a.query.ver=window._wtmpostfix),r.attr("data-original",i.format(a,0)),r.data("original",i.format(a,0)),r.on("load",e),r.on("error",n),this.src=i.format(a,0)}))}))}),400);t((function(){"function"==typeof window.MutationObserver?new window.MutationObserver(a).observe(document.body,{childList:!0,subtree:!0}):setInterval(a,1e3),a()}))}));