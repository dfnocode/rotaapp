!function(e,n){"use strict";"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define("html-truncate",[],(function(){return n()})):n()}(0,(function(){return function(e,n,i){var s,t,r,o,l,u=10>n?n:10,f=["img","br"],a=[],d=0,g="",p='([\\w|-]+\\s*(=\\s*"[^"]*")?\\s*)*',c=new RegExp("<\\/?\\w+\\s*"+p+"\\s*\\/\\s*>"),x=new RegExp("<\\/?\\w+\\s*"+p+"\\s*\\/?\\s*>"),b=/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)|((mailto:)?[_.\w\-]+@([\w][\w\-]+\.)+[a-zA-Z]{2,3})/g,h=new RegExp("<img\\s*"+p+"\\s*\\/?\\s*>"),w=new RegExp("\\W+","g"),m=!0;function k(e){var n=e.indexOf(" ");if(-1===n&&-1===(n=e.indexOf(">")))throw new Error("HTML tag is not well-formed : "+e);return e.substring(1,n)}function v(e,s){var t,r,o=n-d,l=o,u=o<i.slop,f=u?o:i.slop-1,a=u?0:o-i.slop,g=s||o+i.slop;if(!i.truncateLastWord){if(t=e.slice(a,g),s&&t.length<=s)l=t.length;else for(;null!==(r=w.exec(t));){if(!(r.index<f)){if(r.index===f){l=o;break}l=o+(r.index-f);break}if(l=o-(f-r.index),0===r.index&&o<=1)break}e.charAt(l-1).match(/\s$/)&&l--}return l}for((i=i||{}).ellipsis=void 0!==i.ellipsis?i.ellipsis:"...",i.truncateLastWord=void 0===i.truncateLastWord||i.truncateLastWord,i.slop=void 0!==i.slop?i.slop:u;m;){if(!(m=x.exec(e))){if(d>=n)break;if(!(m=b.exec(e))||m.index>=n){g+=e.substring(0,v(e));break}for(;m;)s=m[0],t=m.index,g+=e.substring(0,t+s.length-d),e=e.substring(t+s.length),m=b.exec(e);break}if(s=m[0],t=m.index,d+t>n){g+=e.substring(0,v(e,t));break}d+=t,g+=e.substring(0,t),"/"===s[1]?(a.pop(),o=null):(o=c.exec(s))||(r=k(s),a.push(r)),g+=o?o[0]:s,e=e.substring(t+s.length)}return e.length>n-d&&i.ellipsis&&(g+=i.ellipsis),g+=(l="",a.reverse().forEach((function(e,n){-1===f.indexOf(e)&&(l+="</"+e+">")})),l),i.keepImageTag||(g=function(e){var n,i,s=h.exec(e);return s?(n=s.index,i=s[0].length,e.substring(0,n)+e.substring(n+i)):e}(g)),g}}));