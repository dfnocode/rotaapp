define(["jquery","i18n","ApiError","bootstrap-validator"],(function(t,e,r){"use strict";var a=t(window),i={focus:!1};t.extend(t.fn,{visible:function(t,e,r){if(!(this.length<1)){var i=this.length>1?this.eq(0):this,o=i.get(0),s=a.width(),n=a.height(),l=!0!==e||o.offsetWidth*o.offsetHeight;if(r=r||"both","function"==typeof o.getBoundingClientRect){var d=o.getBoundingClientRect(),c=d.top>=0&&d.top<n,h=d.bottom>0&&d.bottom<=n,u=d.left>=0&&d.left<s,f=d.right>0&&d.right<=s,p=t?c||h:c&&h,v=t?u||f:u&&f;if("both"===r)return l&&p&&v;if("vertical"===r)return l&&p;if("horizontal"===r)return l&&v}else{var b=a.scrollTop(),g=b+n,m=a.scrollLeft(),w=m+s,k=i.offset(),I=k.top,C=I+i.height(),A=k.left,E=A+i.width(),x=!0===t?C:I,y=!0===t?I:C,D=!0===t?E:A,T=!0===t?A:E;if("both"===r)return!!l&&y<=g&&x>=b&&T<=w&&D>=m;if("vertical"===r)return!!l&&y<=g&&x>=b;if("horizontal"===r)return!!l&&T<=w&&D>=m}}},validate:function(e){var o=t(this);if(o.data("pok.validate"))return this;function s(){t(this).prop("invalid",!1).prop("valid",!0),t(this).closest(".has-error").removeClass("has-error")}function n(t){if(t.closest(".form-group, .input-group").length?t.closest(".form-group, .input-group").addClass("has-error"):t.closest(".checkbox, .radio").length?t.closest(".checkbox, .radio").addClass("has-error"):t.closest(".custom-checkbox").length?t.closest(".custom-checkbox").addClass("has-error"):t.closest(".customCheckbox").length?t.closest(".customCheckbox").parent().addClass("has-error"):t.addClass("has-error"),t.prop("invalid",!0).prop("valid",!1),t.is(":visible")){var e=t.closest(".form-group").length?t.closest(".form-group"):t;e.visible(!0)||(o.closest(".ps")&&(o.closest(".ps").scrollTop=0),e[0].parentElement.scrollIntoView())}else window.appError(new r("A required form control is not visible"))}function l(){t(this).data("slider-range")?t(this).val()==t(this).data("slider-min")+","+t(this).data("slider-max")&&t(this).val(""):t(this).val()==t(this).data("slider-min")&&t(this).val("")}return o.find(':input:not([type="hidden"], [type="submit"], [type="reset"], button, :checkbox, :radio, select)').each((function(){t(this).closest(".form-group").addClass("has-feedback").find("label").addClass("control-label")})),o.validator(t.extend({},i,e)),o.attr("role")||o.attr("role","form"),o.submit((function(e){var i=0;function s(){var e=t(this);if((e.closest(".form-group, .input-group").filter(":visible").hasClass("has-error")||e.filter(":visible").hasClass("has-error"))&&(i=1),(e.prop("required")||e.attr("required"))&&(!function(){try{e.val&&"string"==typeof e.val()&&e.val(e.val().trim())}catch(t){}}(),e.is("[type='checkbox']")&&!e.is(":checked")?(n(e.parent()),i=1):e.is("fieldset")&&e.find("[data-ref]:checked").length?e.find("[data-ref]:checked").each((function(){var r=o.find("input[name='"+t(this).data("ref")+"']");r.length&&""===r.val().trim()&&(n(e),n(r),i=1)})):e.is("[type='checkbox']")||e.is("fieldset")||null!==e.val()&&""!==e.val()||(e.is("[type='radio']")?n(e.parent()):n(e),i=1),!e.data("validateattr")||""!==e.data(e.data("validateattr"))&&null!==e.data(e.data("validateattr"))&&void 0!==e.data(e.data("validateattr"))||(n(e),i=1)),e.data("intlTelInput")&&e.val()&&e.data("intlTelInput").getValidationError()){switch(e.data("intlTelInput").getValidationError()){case 1:window.appError(new r("Invalid phone country code",r.Subject.INVALID_DATA));break;case 2:window.appError(new r("Phone number is to short",r.Subject.INVALID_DATA));break;case 3:window.appError(new r("Phone number is to long",r.Subject.INVALID_DATA));break;case 4:case 5:case-99:window.appError(new r("Not a phone number",r.Subject.INVALID_DATA))}n(e),i=1}e.data("getValidationError")&&e.data("getValidationError")()&&(window.appError(new r("Start date can not be after end")),n(e),i=1);var a=e.data("validate");"url"===a&&e.val()&&!/^(https?:\/\/)?([a-z.-\d]+)\.([a-z.]{2,6})([+/\w .-]*)*\/?/i.test(e.val().trim())&&(n(e),i=1),"checkbox"!==a&&"radio"!==a||e.find(":checked").length||(n(e),i=1)}try{if(o.find("[data-slider-value]").each(l),o.find("[data-validate], [required]").each(s),o.attr("id")&&(t('[form="'+o.attr("id")+'"]').filter("[data-slider-value]").each(l),t('[form="'+o.attr("id")+'"]').filter("[data-validate], [required]").each(s)),i)return e.stopImmediatePropagation(),e.preventDefault(),!1;o.find(".has-error").removeClass("has-error")}catch(t){return e.stopImmediatePropagation(),e.preventDefault(),window.appError(t),!1}o.find(":submit").button("loading"),a.one("UI.unblock appError error pageReload.start unhandledrejection",(function(){setTimeout((function(){o.find(":submit").button("reset")}),500)}))})),o.on("change",".has-error",s),o.on("click",".has-error",s),o.on("keypress",".has-error",s),o.data("pok.validate",!0),this},disableSelection:function(){return this.attr("unselectable","on").css("user-select","none")},deserialize:function(e){this.each((function(){this.reset();for(var r=0,a=Object.entries(e);r<a.length;r++){var i=a[r],o=i[0],s=i[1];t(this).find('[name="'+o+'"]').val(s)}}))}})}));