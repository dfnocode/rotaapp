function asyncGeneratorStep(e,t,r,n,a,o,i){try{var c=e[o](i),u=c.value}catch(e){return void r(e)}c.done?t(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){asyncGeneratorStep(o,n,a,i,c,"next",e)}function c(e){asyncGeneratorStep(o,n,a,i,c,"throw",e)}i(void 0)}))}}define(["jquery","api","clitpl","lodash","datePickers","moment","i18n","bootstrap-dialog","admin/calendar/handlers/rate","jquery-block","jquery-addons"],(function(e,t,r,n,a,o,i,c,u){return function(){var s=_asyncToGenerator(regeneratorRuntime.mark((function s(d){var l,f,p,m,v,y,_,b,h;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return h=function(){return(h=_asyncToGenerator(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.$modal.block(),e.prev=1,f=o.utc(v.find("[name='from']").datepicker("getUTCDate")).startOf("day"),p=o.utc(v.find("[name='to']").datepicker("getUTCDate")).startOf("day"),e.next=6,u({apartment:l,_dtfrom:f,_dtto:p});case 6:if(t=e.sent,JSON.stringify(_)!==JSON.stringify(t)){e.next=9;break}return e.abrupt("return",y.$modal.unblock());case 9:return _=t,e.next=12,r._render("calendar/rates_periods",{apartment:l,dts:t});case 12:n=e.sent,y.$modal.find("#rates-block").html(n),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),window.appError(e.t0);case 19:return e.prev=19,y.$modal.unblock(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[1,16,19,22]])})))).apply(this,arguments)},b=function(){return h.apply(this,arguments)},l=d.apartment,f=d._dtfrom,p=d._dtto,s.next=5,r._render("calendar/rates",{});case 5:return m=s.sent,v=e(m),y=c.show({title:i("Edit Rate Values"),type:c.TYPE_DEFAULT,message:v,onshown:function(e){window.setFullscreenModal(e.$modal)},buttons:[{label:i("Save"),cssClass:"btn-primary",autospin:!1,action:function(e){v.submit()}},{label:i("Cancel"),cssClass:"btn-default",autospin:!1,action:function(e){e.close()}}]}),a(v.find("[name='from']"),f,v.find("[name='to']"),p),v.find("[name='from'], [name='to']").datepicker("setStartDate",o.utc(Date.nowUTC()).toDate()),_=null,v.find("[name='from'], [name='to']").change(n.debounce(b,500)).change(),v.validate().submit(function(){var r=_asyncToGenerator(regeneratorRuntime.mark((function r(n){var a;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.preventDefault(),a={_dtfrom:f,_dtto:p,_idapartment:l._id,periods:v.find(".rate").toArray().map((function(t){var r,n=e(t),a=n.find("[name=val]").data("number-value");return a?{_i_value:n.data("rate"),_mcsell:(r={},r[l._t_curr]=a,r)}:{_i_value:n.data("rate")}})).filter(Boolean)},v.block(),r.prev=3,r.next=6,t.call("price.editPriceRates",a);case 6:y.$modal.trigger("frm-saved"),y.close(),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(3),window.appError(r.t0);case 13:return r.prev=13,v.unblock(),r.finish(13);case 16:case"end":return r.stop()}}),r,null,[[3,10,13,16]])})));return function(e){return r.apply(this,arguments)}}()),s.abrupt("return",y.$modal);case 14:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()}));