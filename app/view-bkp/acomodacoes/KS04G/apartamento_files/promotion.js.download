function _createForOfIteratorHelperLoose(r,e){var t;if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=_unsupportedIterableToArray(r))||e&&r&&"number"==typeof r.length){t&&(r=t);var n=0;return function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(t=r[Symbol.iterator]()).next.bind(t)}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function asyncGeneratorStep(r,e,t,n,o,a,i){try{var u=r[a](i),c=u.value}catch(r){return void t(r)}u.done?e(c):Promise.resolve(c).then(n,o)}function _asyncToGenerator(r){return function(){var e=this,t=arguments;return new Promise((function(n,o){var a=r.apply(e,t);function i(r){asyncGeneratorStep(a,n,o,i,u,"next",r)}function u(r){asyncGeneratorStep(a,n,o,i,u,"throw",r)}i(void 0)}))}}define(["moment","lodash","dateDiff","clitpl","api","api!core.getAppCfg"],(function(r,e,t,n,o,a){return function(){var i=_asyncToGenerator(regeneratorRuntime.mark((function i(u){var c,s,d,l,p,f,y,_,m;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(c=u._id,s=u.apartment,d=u._dtfrom,l=u._dtto,!c||"new"===c){i.next=7;break}return i.next=4,o.call("promotion.getPromotion",c);case 4:p=i.sent,i.next=9;break;case 7:f=t(d,l,"day"),p={_idowner:s._id,_mctotal:{},periods:"basic"===a.priceModel.model?e.cloneDeep(a.priceModel.periods):[{_i_value:f}],_dtfrom:r.utc(d).startOf("day").hours(12).toDate(),_dtto:r.utc(l).startOf("day").hours(12).toDate()};case 9:for(y=_createForOfIteratorHelperLoose(p.periods||[]);!(_=y()).done;)(m=_.value)._id=m._id||"new";if(i.t1=p._t_curr||s._t_curr,i.t1){i.next=15;break}return i.next=14,o.call("price.getApartMainCurrency",s._id);case 14:i.t1=i.sent;case 15:if(i.t0=i.t1,i.t0){i.next=18;break}i.t0=window.__defaultCurr;case 18:return p._t_curr=i.t0,i.abrupt("return",n._render("calendar/promotion_edit",{promotion:p}));case 20:case"end":return i.stop()}}),i)})));return function(r){return i.apply(this,arguments)}}()}));