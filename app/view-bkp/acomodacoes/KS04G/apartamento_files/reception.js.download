define(["jquery","i18n","clitpl","api","lodash","safe","datePickers","moment","bootstrap-dialog","admin/agentac","jquery-block","jquery-addons"],(function(n,e,i,t,a,o,r,d,s,l){return function(c){var f=c.title,u=c.from,v=c.to;return n((function(){"use strict";n("head > title, body #subtitle").text(f);var c=n("#maincontent"),p=c.find(".reception"),m=c.find("#filterform");r(m.find("input.from"),u,m.find("input.to"),v),l(m.find('[name="agent"]')),c.on("click",".btn-assign-worker",(function(){var a=n(this).data("_idtask"),r=n(this).data("_idworker");return o.run((function(d){i.render("reception_add_worker",{_idworker:r},o.sure(d,(function(i){var o=n(i);o.validate().submit((function(n){n.preventDefault();var e={_id:a,_idworker:o.find("#task-worker").data("staffid")};return o.block(),t.call("task.assigneeWorker",{task:e,ignoreWorkingTime:!0},(function(n){o.unblock(),window.pageReload(n)})),!1})),s.show({title:e("Assing worker"),message:o,buttons:[{label:e("Save"),cssClass:"btn-primary",autospin:!1,action:function(){o.submit()}},{label:e("Cancel"),cssClass:"btn-default",autospin:!1,action:function(n){n.close()}}]})})))}),window.appError),!1})),c.find(".clientArrived").click((function(){var i=n(this),a=i.closest(".panel"),r=a.data("_id");s.confirm({title:e("Warning!"),type:s.TYPE_WARNING,message:e("Are you sure?"),callback:function(n){n&&(c.block(),o.run((function(n){t.call("reserve.updateFields",r,{_b_arrived:1},o.sure(n,(function(){a.find(".arrived").removeClass("hidden"),i.remove(),n()})))}),(function(n){c.unblock(),window.appError(n)})))}})}));var b=a.debounce((function(){var e=n(this);setTimeout((function(){var i=e.val();i?(p.hide(),i=i.toUpperCase(),p.filter("[data-avatar*='"+i+"']").show(),p.find(".client-name").each((function(e,t){n(t).text().toUpperCase().includes(i)&&n(t).closest(".reception").show()}))):p.show()}),0)}),100);function h(){var n=p.find(".panel").not(".invisible").not(".empty"),i=n.length,t=n.filter(".resolved").length,a=i-t;c.find(".countlabel").text(e("Total")+" "+i),c.find(".resolvelabel").text(e("Done")+" "+t),c.find(".unresolvelabel").text(e("Pendent")+" "+a)}c.find("#quickinput").keyup(b),c.find("[name='optionView']").change((function(){var e=n(this).val();return"all"==e?(p.removeClass("hidden"),p.find(".panel").removeClass("invisible"),void h()):"in/out"==e?(p.removeClass("hidden"),p.find(".panel").removeClass("invisible"),a.each(p,(function(e){var i=n(e);i.find(".empty").length&&(i.find(".panel").addClass("invisible"),i.addClass("hidden"))})),void h()):(p.find(".panel").not("[data-direction='"+e+"']").addClass("invisible").end().filter("[data-direction='"+e+"']").removeClass("invisible"),p.each((function(){var i=n(this);i.find(".panel[data-direction='"+e+"']").not(".empty").length?i.removeClass("hidden"):i.addClass("hidden")})),void h())})).change(),m.validate().submit((function(){if(m.find("input.from").val()){var n=d.utc(m.find("input.from").data("datepicker").getUTCDate());m.find('input[name="from"]').val(n.format("YYYY-MM-DD"))}if(m.find("input.to").val()){var e=d.utc(m.find("input.to").data("datepicker").getUTCDate());m.find('input[name="to"]').val(e.format("YYYY-MM-DD"))}}))}))}}));