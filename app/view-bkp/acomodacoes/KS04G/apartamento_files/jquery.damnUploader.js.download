!function(e){"function"==typeof define&&define.amd?define(["jquery"],(function(t){e(t,window)})):"object"==typeof exports?module.exports=e(require("jquery"),window):e(jQuery,window)}((function(e,t){var n=function(e){return void 0!==e&&null!=e},a=!1;if(t.XMLHttpRequest){var i=new XMLHttpRequest;a=n(i.upload)}e.extend(e.support,{fileSelecting:n(t.File)&&n(t.FileList),fileReading:n(t.FileReader),fileSending:n(t.FormData),uploadControl:a});var u=function(e){return e instanceof File||e instanceof Blob},r=function(e){var a="text/plain";if(function(e){return"data:"==e.substr(0,5)}(e=n(e.toString)?e.toString():""+e)){var i=e.split(","),u=i[0].indexOf("base64")>=0?atob(i[1]):unescape(i[1]);a=i[0].split(":")[1].split(";")[0],e=new ArrayBuffer(u.length);for(var r=new Uint8Array(e),l=0;l<u.length;l++)r[l]=u.charCodeAt(l)}return function(e,n){if(t.Blob)return new Blob([e],{type:n});var a=t.MSBlobBuilder||t.MozBlobBuilder||t.WebKitBlobBuilder||t.BlobBuilder;return a?(new a).append(ab).getBlob(n):null}(e,a)},l=function(e,t){var n=e.split("/"),a=t.split("/");return n[0]==a[0]&&("*"==a[1]||n[1]==a[1])};e.fn.damnUploader=function(t){if(0==this.length)return this;if(this.length>1)return this.each((function(){e(this).damnUploader(t)}));var a=this;a._duSettings=e.extend({url:"/upload.php",multiple:!0,fieldName:"file",dropping:!0,dropBox:!1,limit:!1,dataType:"text",method:"POST",acceptType:null},t||{}),!a._duSettings.multiple&&(a._duSettings.limit=1);var i=function(e,t,n){this.file=e,this.fieldName=null,this.replaceName=null,this.progressCallback=n,this.completeCallback=t,this.xhr=null,this.cancelled=!1,this.started=!1,this.completed=!1,this._id=function e(t,n){return n=n||"",0==(t=parseInt(t))||isNaN(t)?n:n+String.fromCharCode(Math.floor(26*Math.random())+97)+e(--t)}(7),this._post=[]};e.extend(i.prototype,{id:function(){return this._id},addPostData:function(t,n){var a=this;e.isArray(t)?e.each(t,(function(e,t){a.addPostData(t.name,t.value)})):this._post.push({name:t,value:n})},upload:function(){a._duUploadItem(this)},cancel:function(){a.duCancel(this._id)},getReaderCallback:function(t){var n;return e.support.fileReading&&((n=new FileReader).onload=t),n},readAs:function(e,t){var n="readAs"+e,a=this.getReaderCallback(t);a&&a[n]&&a[n].call(a,this.file)}}),a._duQueue={},a._duItemsCount=0;var o=a._duQueue,d=a._duSettings;a._duAddItemsToQueue=function(t){var n,i=e.Event("du.add"),u=e.Event("du.limit");if(a._duItemsCount===d.limit)return a.trigger(u),!1;if(t instanceof FileList){var r=[];return e.each(t,(function(e,t){r.push(a._duAddItemsToQueue(t))})),r}if(!1===(n=a.duNewUploadItem(t)))return!1;if(i.uploadItem=n,a.trigger(i),i.isDefaultPrevented())return!1;var l=n.id();return a._duItemsCount++,o[l]=n,n},a._duUploadItem=function(t){if(!e.support.fileSending||!u(t.file))return!1;if(!t.started){t.started=!0;var n=new XMLHttpRequest,a=0,i=!1,r=e.isFunction(t.progressCallback);n.upload?(n.upload.addEventListener("progress",(function(e){e.lengthComputable&&(a=100*e.loaded/e.total,r&&t.progressCallback.call(t,Math.round(a)))}),!1),n.upload.addEventListener("load",(function(e){a=100,i=!0}),!1)):i=!0,n.onreadystatechange=function(){var n=e.isFunction(t.completeCallback);if(4==this.readyState)if(t.completed=!0,this.status<400)if(i){e.isFunction(t.progressCallback)&&t.progressCallback.call(t,100);var a="json"==d.dataType?JSON.parse(this.responseText):this.responseText;n&&t.completeCallback.call(t,!0,a)}else n&&t.completeCallback.call(t,!1,null,0);else n&&t.completeCallback.call(t,!1,this.responseText||this.statusText,this.status)};var l=t.replaceName||t.file.name,o="PUT"==d.method.toString().toUpperCase()?"PUT":"POST";n.open(o,d.url);var s=new FormData;s.append(t.fieldName||d.fieldName||"file",t.file,l),t._post.length>0&&e.each(t._post,(function(e,t){s.append(t.name,t.value)})),n.send(s),t.xhr=n}};var s="INPUT"==a.get(0).tagName&&"file"==this.attr("type");return s&&(a.prop("multiple",d.multiple).on("change",(function(){a._duAddItemsToQueue(this.files)})),null!==d.acceptType&&a.attr("accept",d.acceptType)),d.dropping&&(a.on("drop",(function(e){return a._duAddItemsToQueue(e.originalEvent.dataTransfer.files),!1})),d.dropBox&&e(d.dropBox).on("drop",(function(e){return a._duAddItemsToQueue(e.originalEvent.dataTransfer.files),!1}))),a.on("du.add",(function(e){null!==d.acceptType&&e.uploadItem.file&&(l(e.uploadItem.file.type,d.acceptType)||(e.preventDefault(),e.stopImmediatePropagation()))})),a.duStart=function(){return d.url?(e.each(o,(function(t,n){var i=n.completeCallback;n.completeCallback=function(n,u,r){this.cancelled||(delete o[t],a._duItemsCount--),e.isFunction(i)&&i.call(this,n,u,r),0==a._duItemsCount&&a.trigger("du.completed")},a._duUploadItem(n)})),a):a},a.duCancel=function(e){return e&&a._duItemsCount>0&&n(o[e])&&(o[e].xhr&&(o[e].cancelled=!0,o[e].xhr.abort()),delete o[e],a._duItemsCount--),a},a.duCancelAll=function(){return s&&a.val(""),e.each(o,(function(e,t){a.duCancel(e)})),a},a.duNewUploadItem=function(e){switch(!0){case e instanceof i:return e;case u(e):return new i(e);default:var t=r(e);return!1!==t&&a.duNewUploadItem(t)}},a.duEnqueue=function(e){return a._duAddItemsToQueue(e)},a.duGetQueue=function(){return a._duQueue},a.duCount=function(){return a._duItemsCount},a.duOption=function(t,n){if(e.isPlainObject(t))e.each(t,(function(e,t){a.duOption(e,t)}));else{if(void 0===n)return a._duSettings[t];e.inArray(t,["url","fieldName","limit","dataType","method"])>-1&&(a._duSettings[t]=n)}return a},a.duIsAcceptedType=function(e){return null===d.acceptType||l(e,d.acceptType)},a}}));