function asyncGeneratorStep(e,t,o,n,r,a,i){try{var s=e[a](i),u=s.value}catch(e){return void o(e)}s.done?t(u):Promise.resolve(u).then(n,r)}function _asyncToGenerator(e){return function(){var t=this,o=arguments;return new Promise((function(n,r){var a=e.apply(t,o);function i(e){asyncGeneratorStep(a,n,r,i,s,"next",e)}function s(e){asyncGeneratorStep(a,n,r,i,s,"throw",e)}i(void 0)}))}}define(["jquery","safe","lodash","clitpl","iziToast","ApiError","i18n","jquery-uploader"],(function(e,t,o,n,r,a,i){"use strict";var s=i("Are you sure you want to leave this page? You have uncomplete upload.");e(window).on("beforeunload",(function(t){if(e(".iziToast.not-uploaded").length)return t&&(t.preventDefault(),t.returnValue=s),s})),e.extend(e.fn,{photoUploader:function(i){var s=this;return _asyncToGenerator(regeneratorRuntime.mark((function u(){var d,p,c,l,f,h,g,v,m,w,y,b,x,T,C;return regeneratorRuntime.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(C=function(t){var o="U"+Math.random().toString(35).substr(2,8).toUpperCase();return r.show({icon:"",class:"not-uploaded "+o,layout:1,progressBar:!0,drag:!1,image:window.URL.createObjectURL(t.file),imageWidth:60,timeout:null,closeOnEscape:!1,maxWidth:"300px",message:'<div class="progress '+o+'"><div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar" style="width: 0%"></div></div>'}),e(".iziToast."+o).css("height","20px")[0]},T=function(){o.filter(v,"popup").forEach((function(e){try{e.popup.isConnected&&r.progress({timeout:e._id?100:1e4},e.popup,null).start()}catch(e){}})),i(o.map(v,"_id").filter(Boolean)),v=[]},x=function(t,o){var n,r=t.uploadItem,i={_id:null,popup:null};v.push(i),p&&r.addPostData("ownerId",p),c&&r.addPostData("ownerCol",c),f&&r.addPostData("title",f),l&&r.addPostData("validate",l),r.progressCallback=function(e){n.text(e+"%").css("width",e+"%")},r.completeCallback=function(t,r){try{r=JSON.parse(r)}catch(e){}if(!t){var s=new a(r||"Upload was failed. Please check that file not corrupted");return e(i.popup).removeClass("not-uploaded").addClass("iziToast-color-red").css("height","").find(".iziToast-body").html(s.message||s),o(s)}n.parent().remove(),e(i.popup).removeClass("not-uploaded").addClass("iziToast-color-success"),i._id=r[0],o()},r.readAs("DataURL",(function(){var t=new window.FileReader;t.onloadend=function(){i.popup=C(r),e(i.popup).find(".iziToast-close").click((function(e){y.duCancel(r._id)})),n=e(i.popup).find(".progress-bar"),r.upload()},t.readAsArrayBuffer(r.file)}))},b=function(e){g.toggleClass("dropBox-hover",e)},(d=e(s)).length){u.next=7;break}return u.abrupt("return");case 7:if(p=d.data("ownerid"),c=d.data("ownercol"),l=d.data("validate"),f=d.data("title"),c){u.next=13;break}throw new a("Unknown parent document reference",a.Subject.INVALID_DATA);case 13:return u.next=15,n._render("upload/photo",{});case 15:h=u.sent,g=e(h),d.append(g),v=[],(m=t.queue(x,10)).drain=T,w={url:"/image/upload",method:"POST",fieldName:"images",dropBox:g},!1===d.data("multiple")&&(w.multiple=!1),y=g.find("input[type='file']").damnUploader(w),g.on("click",(function(e){return g.find("input[type='file']").trigger(e),!1})),g.find("input[type='file']").click((function(e){e.stopPropagation()})),g.on({dragenter:function(){b(!0)},dragover:function(){return b(!0),!1},dragleave:function(){setTimeout((function(){b(!1)}),50)},drop:function(){b(!1)}}),y.on({"du.add":function(e){m.push(e)}});case 28:case"end":return u.stop()}}),u)})))()}})}));