function asyncGeneratorStep(e,n,t,r,a,o,i){try{var c=e[o](i),s=c.value}catch(e){return void t(e)}c.done?n(s):Promise.resolve(s).then(r,a)}function _asyncToGenerator(e){return function(){var n=this,t=arguments;return new Promise((function(r,a){var o=e.apply(n,t);function i(e){asyncGeneratorStep(o,r,a,i,c,"next",e)}function c(e){asyncGeneratorStep(o,r,a,i,c,"throw",e)}i(void 0)}))}}define(["jquery","api","clitpl","decimal","lodash","moment","jquery-block"],(function(e,n,t,r,a,o){return function(i){var c=i.$modal_,s=i.is_new,_=i.isAssignPayment,d=i._idledger,u=i._idreserve,m=i.client,l=i._b_extra,p=i._b_deposit,f=i.paymentType;return e(_asyncToGenerator(regeneratorRuntime.mark((function i(){var y,v,b,w,h;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.call("ledger.getFinanceAccounts",{},{});case 2:if(v=i.sent,!s){i.next=11;break}(y={_dt:o.utc(Date.nowUTC()).toDate(),_idreserve:u})._t_client=m.name,y._idcontact=m._id,f&&(y.type=f),p?y._b_deposit=1:l&&(y._b_extra=1),i.next=14;break;case 11:return i.next=13,n.call("ledger.getLedgerById",d);case 13:y=i.sent;case 14:return!s&&y._t_contact&&(y._t_client=y._t_contact.name),y._t_banks=v,y._idbank&&(b=a.find(v,(function(e){return e._id==y._idbank})),y._t_pfee={},b.comissions&&(a.each(b.comissions,(function(e,n){y._t_pfee[n]=new r(parseFloat(b.comissions[n])||0).times(y._mcval[n]).div(100).round(2).toNumber()})),y._t_comissions=b.comissions),!y._dtforward&&b._i_days&&(y._dtforward=o.utc(y._dt).add(b._i_days,"day").toDate())),y._t_pendable=!0,_&&(y._t_hideform=1),i.next=21,t._render("reservation/booking_payment_edit",y);case 21:w=i.sent,(h=e(w).modal()).on("paymentfrm-saved",function(){var t=_asyncToGenerator(regeneratorRuntime.mark((function t(r,a,o){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h.block(),t.prev=1,t.next=4,n.call("finance.savePayment",{is_new:s,payment:y,payment1:a,payment2:o,_idreserve:u});case 4:h.modal("hide"),c&&(c.remove(),e(".modal-backdrop").remove(),c=null),window.pageReload(),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),window.appError(t.t0);case 12:return t.prev=12,h.unblock(),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,9,12,15]])})));return function(e,n,r){return t.apply(this,arguments)}}()),h.on("paymentfrm-cancel",(function(){h.modal("hide")}));case 25:case"end":return i.stop()}}),i)}))))}}));